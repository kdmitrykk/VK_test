# VK_test
# Поиск коротких заставок в сериалах

Этот проект реализует полный пайплайн для автоматического определения короткой интро-заставки (1–10 секунд) в начале каждой серии.  
Задача сводится к тому, чтобы по видео- и аудиопотокам вывести относительные метки начала и конца заставки.

---

**Особенности решения:**
- Рассматривается совокупность как аудио, так и видео фрагментов
- Multi-task обучение (регрессия + классификация)
- Прямое предсказание временных отрезков
- Аугментации данных для улучшения обобщения
- Оптимизация для работы с длинными видео (сокращение до 40 секунд)

---

Пример результата: ![image](https://github.com/user-attachments/assets/fa8635be-4d20-48fe-8969-99743aba27b7)

gt_start и gt_end - правдивые метки начала и конца заставки, pred_start и pred_end - результат обучения

## Структура файла

Весь код собран в одном файле .ipynb. Вот основные моменты:

1. **Класс датасета `IntroDataset`**  
   - **Инициализация**  
     - `root_dir: str` — папка с `.mp4`  
     - `labels_json: str` — JSON с разметкой `{ "episode.mp4": {"start": "00:00:05", "end": "00:00:12"} }`  
     - `seq_len: int`, `fps: int`, `train: bool`  
   - **Метод `__getitem__`**  
     - Чтение кадров через OpenCV, ресайз до нужного разрешения  
     - Извлечение аудиофичей (усреднённая амплитуда по `seq_len` сегментам)  
     - Нормализация и упаковка в тензоры  
     - В режиме `train` возвращает кортеж `(video_feats, audio_feats, rel_times, video_id)`, в режиме `test` — `(video_feats, audio_feats, video_id)`  

2. **Модель `IntroDetector`**  
   - **Архитектура**  
     1. `ResNet18` (предобученный) для извлечения признаков из каждого кадра  
     2. Конкатенация видеопризнаков (размер `video_dim`) и аудиопризнаков (`audio_dim=1`)  
     3. Двунаправленный LSTM (`hidden_size=128`, 2 слоя)  
     4. Два “выхода”:  
        - **Регрессия** относительных меток `[start_rel, end_rel]` (последний скрытый → Linear → ReLU → Linear)  
        - **Классификация** наличия интро (последний скрытый → Linear → Sigmoid → `presence_prob`)  

---


## Зависимости

```text
python
torch
torchvision
numpy
pandas
opencv-python
ffmpeg-python
tqdm
